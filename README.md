**Введение**
В данном проекте была реализована модель машинного обучения для прогнозирования цены Bitcoin на основе исторических данных. Основная цель заключалась в создании механизма, который позволяет обновлять модель по запросу и генерировать предсказание цены через 10 минут.
Получение и обработка данных
Для работы с данными о Bitcoin используются данные с yfinance, которые загружаются за последние 7 дней с интервалом в 1 минуту. После этого данные обрабатываются и добавляются дополнительные признаки, такие как час, минута и день недели, что позволяет учитывать влияние времени на цену. Также добавляются лаговые признаки, включающие значения цены за предыдущие 1, 5 и 10 минут, чтобы модель могла учитывать изменения цен в прошлом. Из данных удаляются строки с пропущенными значениями, чтобы избежать искажения результатов обучения модели.
# Функция загрузки данных Bitcoin
    def get_bitcoin_data():
    bitcoin = yf.Ticker("BTC-USD")
    df = bitcoin.history(period="7d", interval="1m")  # Данные за 7 дней с шагом 1 минута
    df.reset_index(inplace=True)


    # Добавляем временные признаки
    df["hour"] = df["Datetime"].dt.hour
    df["minute"] = df["Datetime"].dt.minute
    df["dayofweek"] = df["Datetime"].dt.dayofweek


    # Добавляем лаговые признаки
    df["Close_lag1"] = df["Close"].shift(1)
    df["Close_lag5"] = df["Close"].shift(5)
    df["Close_lag10"] = df["Close"].shift(10)


    return df.dropna()  # Убираем строки с NaN


Обучение модели
Для прогнозирования цены Bitcoin используется модель RandomForestRegressor из библиотеки scikit-learn. В этом шаге происходит подготовка данных: выделяются признаки (например, Open, High, Low, Volume, а также временные и лаговые признаки) и целевая переменная (цена закрытия, Close). Далее данные разделяются на тренировочную и тестовую выборки с использованием метода train_test_split, что позволяет обучить модель на одной части данных и протестировать её на другой. 


Прогнозирование цен
Для этого создается функция, которая будет предсказывать цену через определённый интервал времени (например, 10 минут). Для предсказания используется последняя строка данных, содержащая актуальные значения для всех признаков. Временные признаки (часы, минуты, день недели) обновляются в зависимости от времени прогноза. Затем модель используется для предсказания цены Bitcoin через выбранный интервал времени.


    def predict_future_prices():
    global model, data, features


    # Прогнозируем цену на основе последней строки данных
    last_row = pd.DataFrame([data.iloc[-1][features]], columns=features)  # Последняя строка данных (текущая ситуация)


    # Множество интервалов прогнозирования (например, 10 минут)
    future_times = [10]  # В минутах


    prediction_results = []  # Список для хранения результатов прогнозирования


    for future_time in future_times:
        # Вычисляем будущее время, добавляя нужное количество минут
        future_index = data.index[-1] + pd.Timedelta(minutes=future_time)


        # Обновляем временные признаки для будущего времени
        last_row["hour"] = future_index.hour
        last_row["minute"] = future_index.minute
        last_row["dayofweek"] = future_index.dayofweek


        # Прогнозируем цену на будущее время
        predicted_price = model.predict(last_row)[0]
        prediction_results.append((future_index, predicted_price))
        print(f"Через {future_time} минут ({future_index}): {predicted_price:.5f} USD")


    return prediction_results


# Выполним прогноз
    predictions = predict_future_prices()
Визуализация результов
Для анализа результатов построен график, который отображает как фактические цены на Bitcoin, так и предсказанные значения. Для отображения фактических цен используется последние 500 минут данных. Предсказанные цены добавляются на график в виде точек. В графике также добавлены метки, легенда, сетка и поворот подписей оси X для лучшей читаемости.



# Функция для построения графика фактических и прогнозируемых цен
    def plot_predictions(data, prediction_results):
    plt.figure(figsize=(12, 6))


    # График фактических цен (последние 500 минут данных)
    plt.plot(data.index[-500:], data["Close"].tail(500), label="Фактическая цена", color="blue")


    # Предсказанные значения
    times, prices = zip(*prediction_results)
    plt.scatter(times, prices, color="red", label="Прогноз", marker="x", s=100)


    plt.xlabel("Дата и время")
    plt.ylabel("Цена Bitcoin (USD)")
    plt.title("Прогноз цены Bitcoin")
    plt.legend()
    plt.grid(True)
    plt.xticks(rotation=45)
    plt.show()


# Построим график для фактических и предсказанных цен
    plot_predictions(data, predictions)
Синяя линия – фактическая цена Bitcoin.
Красные крестики – предсказанные значения на будущие временные метки.


**Выводы и перспективы:**

Для прогнозирования цен Bitcoin была использована модель RandomForestRegressor, обученная на данных за последние 7 дней с интервалом в 1 минуту. Включены финансовые и временные признаки, а также лаговые признаки, что позволило модели учитывать прошлые значения цены.
Модель показала хорошую способность предсказания на тестовой выборке. Коэффициент детерминации R2R^2R2 свидетельствует о хорошей объясняющей способности модели, однако для временных рядов эффективнее могут быть модели ARIMA или LSTM.
Механизм прогнозирования на 10 минут вперед показал возможность использования модели для краткосрочного анализа. Результаты предсказаний соответствуют тенденциям рынка в пределах выбранного интервала.
Графики, на которых отображаются как фактические, так и прогнозируемые цены, дают возможность наглядно оценить точность модели и её работу в реальном времени.

**Перспективы и улучшения:**

Другие модели: Для повышения точности прогнозов рекомендуется рассмотреть ARIMA, SARIMA или LSTM, которые лучше подходят для временных рядов.


Дополнительные факторы: Включение данных о страхе и жадности, новостях и макроэкономических показателях улучшит прогнозирование.


Оптимизация модели: Оптимизация гиперпараметров с помощью GridSearchCV или RandomizedSearchCV поможет повысить эффективность модели.


Прогнозирование на большие сроки: Для прогнозов на более длительные сроки (например, 1 день) следует использовать более сложные модели, такие как LSTM.


Тестирование на реальных данных: Тестирование модели на реальных данных рынка поможет проверить её работу в условиях реальной торговли.






